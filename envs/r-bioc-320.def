# Adatped from: https://github.com/billila/pca_scwf_paper/blob/main/envs/bioc_3_20_pca_wfsc.def
# Author: Samuel Gunz

Bootstrap: docker
From: bioconductor/bioconductor_docker:RELEASE_3_20

%post
    # Install packages using apt-get
    apt-get update && apt-get install -y python3.12 libhdf5-dev libicu-dev \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/* \
    && ln -s /usr/bin/python3 /usr/bin/python 

    # Installation of Bioc packages
    R -q - <<'RSCRIPT'
pkgs <- c(
    "rARPACK", "RSpectra", "SingleCellExperiment", "zellkonverter",
    "BiocSingular", "here", "HDF5Array", "mbkmeans", "ggplot2",
    "scater", "scran", "BiocParallel", "DelayedMatrixStats",
    "rhdf5", "MultiAssayExperiment", "SingleCellMultiModal",
    "scuttle", "AnnotationDbi", "mclust", "bluster", "leidenbase",
    "DelayedArray", "dplyr", "Seurat", "patchwork",
    "scrapper", "TENxBrainData", "EnsDb.Hsapiens.v75",
    "biomaRt", "DropletUtils", "argparse", "GEOquery",
    "satijalab/azimuth", "bnprks/BPCells/r"
)

pkgs_src <- c("stringi", "SeuratObject", "SeuratDisk")

BiocManager::install(pkgs, ask = FALSE)
BiocManager::install(pkgs_src, ask = FALSE, type = "source")
RSCRIPT

%environment
# ensures proper encoding
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8
